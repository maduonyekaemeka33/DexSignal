<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DexSignal | Professional Terminal</title>
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.js"></script>
    <script src="https://bundle.run/buffer@6.0.3"></script>
    <script>window.Buffer = window.Buffer || buffer.Buffer;</script>
    <style>
        :root { --primary: #38bdf8; --bg: #030712; --card: #0f172a; --border: #1e293b; }
        body { background: var(--bg); color: white; font-family: 'Inter', sans-serif; margin: 0; zoom: 85%; overflow: hidden; }
        .container { display: grid; grid-template-columns: 300px 400px 1fr; height: 100vh; }
        .sidebar { background: #020617; border-right: 1px solid var(--border); padding: 20px; overflow-y: auto; }
        .main-swap { padding: 30px; border-right: 1px solid var(--border); display: flex; flex-direction: column; gap: 20px; }
        .chart-area { background: #000; }
        input { width: 100%; background: #000; border: 1px solid var(--border); padding: 12px; color: white; border-radius: 8px; margin-top: 5px; box-sizing: border-box; }
        .btn { width: 100%; padding: 15px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; background: var(--primary); color: #000; transition: 0.2s; }
        .token-row { padding: 10px; cursor: pointer; border-bottom: 1px solid #1e293b66; font-size: 13px; }
        .token-row:hover { background: #1e293b; }
        iframe { width: 100%; height: 100%; border: none; }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <h3 style="color: var(--primary); margin-top:0;">⚡ Live Signals</h3>
            <div id="signalList"></div>
        </div>
        <div class="main-swap">
            <div style="text-align:center">
                <h2 style="margin:0; letter-spacing:-1px">DEXSIGNAL</h2>
                <p style="font-size:10px; color:#64748b">JUPITER V6 AGGREGATOR</p>
            </div>
            <button id="connectBtn" class="btn" style="background:#1e293b; color:white">Connect Wallet</button>
            <div id="walletStatus" style="font-size:10px; text-align:center; color:#94a3b8">Status: Disconnected</div>
            <div>
                <label style="font-size:11px; color:#94a3b8">INPUT (SOL)</label>
                <input id="inputMint" value="So11111111111111111111111111111111111111112">
                <input id="amount" type="number" value="0.1">
            </div>
            <div>
                <label style="font-size:11px; color:#94a3b8">OUTPUT (TARGET TOKEN)</label>
                <input id="outputMint" placeholder="Select a signal or paste mint">
            </div>
            <button id="swapBtn" class="btn">EXECUTE TRADE</button>
            <p style="font-size:10px; color:#475569; text-align:center">Platform Fee: 0.2% • Slippage: 0.5%</p>
        </div>
        <div class="chart-area">
            <iframe id="chart" src="https://dexscreener.com/solana/So11111111111111111111111111111111111111112?embed=1&theme=dark&trades=0"></iframe>
        </div>
    </div>
    <script>
        const tokens = [
            { name: "Jupiter", mint: "JUPyiZJpEGkW4thNsSBkS7HsSBYfCAzYkB5566T7H3", change: "+12.4%" },
            { name: "Bonk", mint: "DezXAZ8z7PnrnAn9rr5yS9yMGL5iS679k6sM8y9iM8M8", change: "+24.8%" },
            { name: "Wif", mint: "EKpQGSJtjMFqKZ9KQanAtu7YXQdAd9V87V48jU4uS7C3", change: "+15.2%" }
        ];
        const container = document.getElementById('signalList');
        tokens.forEach(t => {
            const div = document.createElement('div');
            div.className = 'token-row';
            div.innerHTML = `<b>${t.name}</b> <span style="float:right; color:#22c55e">${t.change}</span>`;
            div.onclick = () => {
                document.getElementById('outputMint').value = t.mint;
                document.getElementById('chart').src = `https://dexscreener.com/solana/${t.mint}?embed=1&theme=dark&trades=0`;
            };
            container.appendChild(div);
        });

        let wallet;
        document.getElementById('connectBtn').onclick = async () => {
            const resp = await window.solana.connect();
            wallet = resp.publicKey.toString();
            document.getElementById('walletStatus').innerText = "Connected: " + wallet.slice(0,6) + "...";
        };

        document.getElementById('swapBtn').onclick = async () => {
            if (!wallet) return alert("Connect Wallet First!");
            const amt = document.getElementById('amount').value * 1000000000;
            const q = await fetch(`/api/quote?inputMint=${document.getElementById('inputMint').value}&outputMint=${document.getElementById('outputMint').value}&amount=${amt}`);
            const quote = await q.json();
            const s = await fetch('/api/swap', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ quoteResponse: quote, userPublicKey: wallet })
            });
            const { swapTransaction } = await s.json();
            const transaction = solanaWeb3.VersionedTransaction.deserialize(buffer.Buffer.from(swapTransaction, 'base64'));
            const { signature } = await window.solana.signAndSendTransaction(transaction);
            alert("Success! Tx: " + signature);
        };
    </script>
</body>
</html>
